@page "/superadmin/chat-moderation"
@using Microsoft.AspNetCore.Authorization
@using EventForge.DTOs.SuperAdmin
@using EventForge.DTOs.Common
@using EventForge.Client.Shared.Components
@using EventForge.Client.Shared.Components.Dashboard
@attribute [Authorize(Roles = "SuperAdmin")]
@inject IAuthService AuthService
@inject ISuperAdminService SuperAdminService
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar
@inject IDialogService DialogService
@inject ITranslationService TranslationService

<PageTitle>@TranslationService.GetTranslation("superAdmin.pageTitle", "{0} - EventForge Super Admin", TranslationService.GetTranslation("superAdmin.chatModeration", "Moderazione Chat"))</PageTitle>

<PageLoadingOverlay Visible="_isLoading || _isLoadingReports"
                     Message="@(_isLoading ? TranslationService.GetTranslation("messages.loadingPage", "Caricamento pagina...") : TranslationService.GetTranslation("common.loading", "Caricamento..."))" />

@if (!_isLoading)
{
    @if (!_isAuthorized)
    {
        <MudContainer MaxWidth="MaxWidth.Medium" Class="mt-8">
            <MudPaper Class="ef-tile">
                <MudGrid Justify="Justify.Center">
                    <MudItem xs="12">
                        <div class="d-flex flex-column align-center">
                            <MudIcon Icon="Icons.Material.Filled.Block" Color="Color.Error" Size="Size.Medium" Style="font-size: 48px;" />
                            <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-4">@TranslationService.GetTranslation("error.accessDenied", "Accesso Negato")</MudText>
                            <MudText Typo="Typo.body1" Align="Align.Center" Class="mb-4">
                                @TranslationService.GetTranslation("superAdmin.superAdminRoleRequired", "Non hai i permessi per accedere a questa pagina. È richiesto il ruolo Super Amministratore.")
                            </MudText>
                            <MudButton Variant="Variant.Filled" 
                                       Color="Color.Primary" 
                                       StartIcon="Icons.Material.Filled.ArrowBack"
                                       OnClick="@(() => NavigationManager.NavigateTo("/"))">
                                @TranslationService.GetTranslation("superAdmin.returnToHome", "Torna alla Home")
                            </MudButton>
                        </div>
                    </MudItem>
                </MudGrid>
            </MudPaper>
        </MudContainer>
    }
    else
    {
        <div class="chatmoderation-page-root">
            <div class="chatmoderation-top">
                <ManagementDashboard TItem="ReportedMessageDto"
                                     Items="_filteredMessages"
                                     Metrics="_dashboardMetrics"
                                     EntityType="ReportedMessage"
                                     AllowConfiguration="true"
                                     UseServerSide="false" />
            </div>

            <!-- Warning Alert -->
            <MudAlert Severity="Severity.Warning" Class="mb-4">
                <MudText Typo="Typo.h6">⚠️ @TranslationService.GetTranslation("superAdmin.backendNotImplemented", "Backend API Non Implementato")</MudText>
                <MudText Typo="Typo.body2">
                    @TranslationService.GetTranslation("superAdmin.mockDataWarning", "Questa pagina utilizza dati mock. Per abilitare la funzionalità completa, implementa:")
                </MudText>
                <ul>
                    <li><code>GET /api/v1/superadmin/chat-moderation/statistics</code></li>
                    <li><code>GET /api/v1/superadmin/chat-moderation/reported-messages</code></li>
                    <li><code>POST /api/v1/superadmin/chat-moderation/approve/{messageId}</code></li>
                    <li><code>POST /api/v1/superadmin/chat-moderation/block/{messageId}</code></li>
                    <li><code>POST /api/v1/superadmin/chat-moderation/moderate-user/{userId}</code></li>
                </ul>
            </MudAlert>

            <div class="eftable-wrapper">
                <EFTable @ref="_efTable"
                         TItem="ReportedMessageDto"
                         Items="_filteredMessages"
                         IsLoading="_isLoadingReports"
                         ComponentKey="ChatModerationManagement"
                         InitialColumnConfigurations="_initialColumns">
                    <ToolBarContent>
                        <MudText Typo="Typo.h5">
                            @TranslationService.GetTranslation("superAdmin.reportedMessages", "Messaggi Segnalati")
                        </MudText>
                        <MudSpacer />
                        <MudTextField @bind-Value="_searchTerm"
                                      @bind-Value:after="OnSearchChanged"
                                      Label="@TranslationService.GetTranslation("superAdmin.searchMessages", "Cerca messaggi")"
                                      Placeholder="@TranslationService.GetTranslation("superAdmin.searchMessagesPlaceholder", "Cerca per contenuto, mittente...")"
                                      Variant="Variant.Outlined"
                                      Adornment="Adornment.End"
                                      AdornmentIcon="@Icons.Material.Outlined.Search"
                                      Clearable="true"
                                      Class="ef-input" />
                        <MudSelect T="string" @bind-Value="_selectedStatus" @bind-Value:after="OnSearchChanged" 
                                   Label="@TranslationService.GetTranslation("superAdmin.status", "Stato")" 
                                   Placeholder="@TranslationService.GetTranslation("superAdmin.selectStatus", "Tutti gli stati")"
                                   Variant="Variant.Outlined"
                                   Clearable="true"
                                   Class="ml-2"
                                   Style="min-width: 150px;">
                            <MudSelectItem Value="@("")">@TranslationService.GetTranslation("common.all", "Tutti")</MudSelectItem>
                            <MudSelectItem Value="@("pending")">@TranslationService.GetTranslation("superAdmin.pending", "In Attesa")</MudSelectItem>
                            <MudSelectItem Value="@("approved")">@TranslationService.GetTranslation("superAdmin.approved", "Approvato")</MudSelectItem>
                            <MudSelectItem Value="@("blocked")">@TranslationService.GetTranslation("superAdmin.blocked", "Bloccato")</MudSelectItem>
                        </MudSelect>
                        <MudSelect T="string" @bind-Value="_selectedSeverity" @bind-Value:after="OnSearchChanged" 
                                   Label="@TranslationService.GetTranslation("superAdmin.severity", "Gravità")" 
                                   Placeholder="@TranslationService.GetTranslation("superAdmin.selectSeverity", "Tutte")"
                                   Variant="Variant.Outlined"
                                   Clearable="true"
                                   Class="ml-2"
                                   Style="min-width: 150px;">
                            <MudSelectItem Value="@("")">@TranslationService.GetTranslation("common.all", "Tutte")</MudSelectItem>
                            <MudSelectItem Value="@("low")">@TranslationService.GetTranslation("superAdmin.severityLow", "Bassa")</MudSelectItem>
                            <MudSelectItem Value="@("medium")">@TranslationService.GetTranslation("superAdmin.severityMedium", "Media")</MudSelectItem>
                            <MudSelectItem Value="@("high")">@TranslationService.GetTranslation("superAdmin.severityHigh", "Alta")</MudSelectItem>
                            <MudSelectItem Value="@("critical")">@TranslationService.GetTranslation("superAdmin.severityCritical", "Critica")</MudSelectItem>
                        </MudSelect>
                        <ManagementTableToolbar ShowRefresh="true"
                                                ShowCreate="false"
                                                ShowDelete="false"
                                                ShowSelectionBadge="false"
                                                IsDisabled="_isLoadingReports"
                                                OnRefresh="@RefreshDataAsync" />
                    </ToolBarContent>
                    <HeaderContent Context="columnConfigurations">
                        @foreach (var column in columnConfigurations.Where(c => c.IsVisible).OrderBy(c => c.Order))
                        {
                            @if (column.PropertyName == "MessageId")
                            {
                                <EFTableColumnHeader TItem="ReportedMessageDto" PropertyName="MessageId" OnDragStartCallback="@_efTable.HandleColumnDragStart">
                                    <MudTableSortLabel SortBy="@(new Func<ReportedMessageDto, object>(x => x.MessageId))">@TranslationService.GetTranslation("field.messageId", "ID Messaggio")</MudTableSortLabel>
                                </EFTableColumnHeader>
                            }
                            else if (column.PropertyName == "ChatName")
                            {
                                <EFTableColumnHeader TItem="ReportedMessageDto" PropertyName="ChatName" OnDragStartCallback="@_efTable.HandleColumnDragStart">
                                    <MudTableSortLabel SortBy="@(new Func<ReportedMessageDto, object>(x => x.ChatName))">@TranslationService.GetTranslation("field.chatName", "Chat")</MudTableSortLabel>
                                </EFTableColumnHeader>
                            }
                            else if (column.PropertyName == "SenderName")
                            {
                                <EFTableColumnHeader TItem="ReportedMessageDto" PropertyName="SenderName" OnDragStartCallback="@_efTable.HandleColumnDragStart">
                                    <MudTableSortLabel SortBy="@(new Func<ReportedMessageDto, object>(x => x.SenderName))">@TranslationService.GetTranslation("field.senderName", "Mittente")</MudTableSortLabel>
                                </EFTableColumnHeader>
                            }
                            else if (column.PropertyName == "MessageContent")
                            {
                                <EFTableColumnHeader TItem="ReportedMessageDto" PropertyName="MessageContent" OnDragStartCallback="@_efTable.HandleColumnDragStart">
                                    <MudTableSortLabel SortBy="@(new Func<ReportedMessageDto, object>(x => x.MessageContent))">@TranslationService.GetTranslation("field.messageContent", "Contenuto")</MudTableSortLabel>
                                </EFTableColumnHeader>
                            }
                            else if (column.PropertyName == "ReportReason")
                            {
                                <EFTableColumnHeader TItem="ReportedMessageDto" PropertyName="ReportReason" OnDragStartCallback="@_efTable.HandleColumnDragStart">
                                    <MudTableSortLabel SortBy="@(new Func<ReportedMessageDto, object>(x => x.ReportReason))">@TranslationService.GetTranslation("field.reportReason", "Motivo")</MudTableSortLabel>
                                </EFTableColumnHeader>
                            }
                            else if (column.PropertyName == "Severity")
                            {
                                <EFTableColumnHeader TItem="ReportedMessageDto" PropertyName="Severity" OnDragStartCallback="@_efTable.HandleColumnDragStart">
                                    <MudTableSortLabel SortBy="@(new Func<ReportedMessageDto, object>(x => x.Severity))">@TranslationService.GetTranslation("field.severity", "Gravità")</MudTableSortLabel>
                                </EFTableColumnHeader>
                            }
                            else if (column.PropertyName == "ReportedAt")
                            {
                                <EFTableColumnHeader TItem="ReportedMessageDto" PropertyName="ReportedAt" OnDragStartCallback="@_efTable.HandleColumnDragStart">
                                    <MudTableSortLabel SortBy="@(new Func<ReportedMessageDto, object>(x => x.ReportedAt))">@TranslationService.GetTranslation("field.reportedAt", "Segnalato il")</MudTableSortLabel>
                                </EFTableColumnHeader>
                            }
                            else if (column.PropertyName == "Status")
                            {
                                <EFTableColumnHeader TItem="ReportedMessageDto" PropertyName="Status" OnDragStartCallback="@_efTable.HandleColumnDragStart">
                                    <MudTableSortLabel SortBy="@(new Func<ReportedMessageDto, object>(x => x.Status))">@TranslationService.GetTranslation("field.status", "Stato")</MudTableSortLabel>
                                </EFTableColumnHeader>
                            }
                        }
                        <MudTh Class="text-center" Style="min-width:120px;">@TranslationService.GetTranslation("common.actions", "Azioni")</MudTh>
                    </HeaderContent>

                    <RowTemplate Context="item">
                        @{
                            var visibleColumns = _efTable?.ColumnConfigurations?.Where(c => c.IsVisible).OrderBy(c => c.Order).ToList() ?? _initialColumns.Where(c => c.IsVisible).OrderBy(c => c.Order).ToList();
                        }
                        @foreach (var column in visibleColumns)
                        {
                            @if (column.PropertyName == "MessageId")
                            {
                                <MudTd DataLabel="@TranslationService.GetTranslation("field.messageId", "ID Messaggio")">
                                    <MudChip T="string" Size="Size.Small" Color="Color.Primary" Variant="Variant.Outlined">
                                        @item.MessageId
                                    </MudChip>
                                </MudTd>
                            }
                            else if (column.PropertyName == "ChatName")
                            {
                                <MudTd DataLabel="@TranslationService.GetTranslation("field.chatName", "Chat")">
                                    <div class="d-flex align-center">
                                        <MudIcon Icon="@(item.IsGroupChat ? Icons.Material.Filled.Group : Icons.Material.Filled.Person)" 
                                                 Size="Size.Small" 
                                                 Class="mr-2" />
                                        <MudText Typo="Typo.body2">@item.ChatName</MudText>
                                    </div>
                                </MudTd>
                            }
                            else if (column.PropertyName == "SenderName")
                            {
                                <MudTd DataLabel="@TranslationService.GetTranslation("field.senderName", "Mittente")">
                                    <MudText Typo="Typo.body2">@item.SenderName</MudText>
                                </MudTd>
                            }
                            else if (column.PropertyName == "MessageContent")
                            {
                                <MudTd DataLabel="@TranslationService.GetTranslation("field.messageContent", "Contenuto")">
                                    <MudText Typo="Typo.body2" Class="text-truncate" Style="max-width:300px;">
                                        @(string.IsNullOrEmpty(item.MessageContent) ? "-" : item.MessageContent)
                                    </MudText>
                                </MudTd>
                            }
                            else if (column.PropertyName == "ReportReason")
                            {
                                <MudTd DataLabel="@TranslationService.GetTranslation("field.reportReason", "Motivo")">
                                    <MudText Typo="Typo.body2">@item.ReportReason</MudText>
                                </MudTd>
                            }
                            else if (column.PropertyName == "Severity")
                            {
                                <MudTd DataLabel="@TranslationService.GetTranslation("field.severity", "Gravità")">
                                    <MudChip T="string" Size="Size.Small" Color="@GetSeverityColor(item.Severity)">
                                        @GetSeverityText(item.Severity)
                                    </MudChip>
                                </MudTd>
                            }
                            else if (column.PropertyName == "ReportedAt")
                            {
                                <MudTd DataLabel="@TranslationService.GetTranslation("field.reportedAt", "Segnalato il")">
                                    <MudText Typo="Typo.body2">@item.ReportedAt.ToString("dd/MM/yyyy HH:mm")</MudText>
                                </MudTd>
                            }
                            else if (column.PropertyName == "Status")
                            {
                                <MudTd DataLabel="@TranslationService.GetTranslation("field.status", "Stato")">
                                    <MudChip T="string" Size="Size.Small" Color="@GetStatusColor(item.Status)">
                                        @GetStatusText(item.Status)
                                    </MudChip>
                                </MudTd>
                            }
                        }
                        <MudTd DataLabel="@TranslationService.GetTranslation("common.actions", "Azioni")" Class="text-center">
                            <div class="d-flex align-center justify-center ga-1">
                                <MudTooltip Text="@TranslationService.GetTranslation("superAdmin.viewMessage", "Visualizza messaggio")">
                                    <MudIconButton Icon="@Icons.Material.Filled.Visibility"
                                                   Size="Size.Small"
                                                   Color="Color.Primary"
                                                   OnClick="@(() => ViewMessageDetailsAsync(item))" />
                                </MudTooltip>
                                
                                @if (item.Status == "pending")
                                {
                                    <MudTooltip Text="@TranslationService.GetTranslation("superAdmin.approveMessage", "Approva messaggio")">
                                        <MudIconButton Icon="@Icons.Material.Filled.CheckCircle"
                                                       Size="Size.Small"
                                                       Color="Color.Success"
                                                       OnClick="@(() => ApproveMessageAsync(item.MessageId))" />
                                    </MudTooltip>
                                    
                                    <MudTooltip Text="@TranslationService.GetTranslation("superAdmin.blockMessage", "Blocca messaggio")">
                                        <MudIconButton Icon="@Icons.Material.Filled.Block"
                                                       Size="Size.Small"
                                                       Color="Color.Error"
                                                       OnClick="@(() => BlockMessageAsync(item.MessageId))" />
                                    </MudTooltip>
                                }
                                
                                <MudTooltip Text="@TranslationService.GetTranslation("superAdmin.moderateUser", "Modera utente")">
                                    <MudIconButton Icon="@Icons.Material.Filled.PersonOff"
                                                   Size="Size.Small"
                                                   Color="Color.Warning"
                                                   OnClick="@(() => ModerateUserAsync(item.SenderId))" />
                                </MudTooltip>
                            </div>
                        </MudTd>
                    </RowTemplate>

                    <NoRecordsContent>
                        <div class="text-center pa-2 pa-sm-3 pa-md-4">
                            <MudIcon Icon="@Icons.Material.Filled.CheckCircle" 
                                     Size="Size.Medium" 
                                     Color="Color.Success" 
                                     Class="mb-4" />
                            <MudText Typo="Typo.h6" Color="Color.Success" Class="mb-2">
                                @(_reportedMessages.Any() ?
                                    TranslationService.GetTranslation("superAdmin.noMessagesMatchFilters", "Nessun messaggio corrisponde ai filtri applicati") :
                                    TranslationService.GetTranslation("superAdmin.noReportedMessages", "Nessun messaggio segnalato"))
                            </MudText>
                            @if (_reportedMessages.Any())
                            {
                                <MudButton Variant="Variant.Text"
                                           Color="Color.Primary"
                                           StartIcon="@Icons.Material.Outlined.Clear"
                                           OnClick="@ClearFilters">
                                    @TranslationService.GetTranslation("action.clearFilters", "Cancella filtri")
                                </MudButton>
                            }
                            else
                            {
                                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mt-2">
                                    @TranslationService.GetTranslation("superAdmin.noReportedMessagesSubtext", "Tutti i messaggi sono stati moderati o non ci sono segnalazioni")
                                </MudText>
                            }
                        </div>
                    </NoRecordsContent>
                </EFTable>
            </div>
        </div>
    }
}

@code {
    // UI State Management
    private bool _isLoading = true;
    private bool _isAuthorized = false;
    private bool _isLoadingReports = false;

    // Filter and search state
    private string _searchTerm = string.Empty;
    private string _selectedStatus = string.Empty;
    private string _selectedSeverity = string.Empty;
    private CancellationTokenSource? _searchDebounceCts;

    // Data collections
    private List<ReportedMessageDto> _reportedMessages = new();

    // EFTable reference
    private EFTable<ReportedMessageDto> _efTable = null!;

    // Column configuration for EFTable
    private List<EFTableColumnConfiguration> _initialColumns = new()
    {
        new() { PropertyName = "MessageId", DisplayName = "ID Messaggio", IsVisible = true, Order = 0 },
        new() { PropertyName = "ChatName", DisplayName = "Chat", IsVisible = true, Order = 1 },
        new() { PropertyName = "SenderName", DisplayName = "Mittente", IsVisible = true, Order = 2 },
        new() { PropertyName = "MessageContent", DisplayName = "Contenuto", IsVisible = true, Order = 3 },
        new() { PropertyName = "ReportReason", DisplayName = "Motivo", IsVisible = true, Order = 4 },
        new() { PropertyName = "Severity", DisplayName = "Gravità", IsVisible = true, Order = 5 },
        new() { PropertyName = "ReportedAt", DisplayName = "Segnalato il", IsVisible = true, Order = 6 },
        new() { PropertyName = "Status", DisplayName = "Stato", IsVisible = true, Order = 7 }
    };

    // Dashboard configuration
    private List<DashboardMetric<ReportedMessageDto>> _dashboardMetrics = new()
    {
        new()
        {
            Title = "Total Reported",
            Type = MetricType.Count,
            Icon = Icons.Material.Outlined.Report,
            Color = "primary",
            Description = "Numero totale di messaggi segnalati (mock data)",
            Format = "N0"
        },
        new()
        {
            Title = "Pending Review",
            Type = MetricType.Count,
            Filter = m => m.Status == "pending",
            Icon = Icons.Material.Outlined.HourglassEmpty,
            Color = "warning",
            Description = "Segnalazioni in attesa di moderazione",
            Format = "N0"
        },
        new()
        {
            Title = "Blocked Today",
            Type = MetricType.Count,
            Filter = m => m.Status == "blocked" && m.ReportedAt >= DateTime.Today,
            Icon = Icons.Material.Outlined.Block,
            Color = "error",
            Description = "Messaggi bloccati oggi",
            Format = "N0"
        },
        new()
        {
            Title = "High Severity",
            Type = MetricType.Count,
            Filter = m => m.Severity == "high" || m.Severity == "critical",
            Icon = Icons.Material.Outlined.Warning,
            Color = "info",
            Description = "Segnalazioni con gravità alta o critica",
            Format = "N0"
        }
    };

    /// <summary>
    /// Computed property for filtered messages based on search criteria.
    /// </summary>
    private IEnumerable<ReportedMessageDto> _filteredMessages => 
        _reportedMessages.Where(m => 
            // Search filter
            (string.IsNullOrEmpty(_searchTerm) || 
             m.MessageContent.Contains(_searchTerm, StringComparison.OrdinalIgnoreCase) ||
             m.SenderName.Contains(_searchTerm, StringComparison.OrdinalIgnoreCase) ||
             m.ChatName.Contains(_searchTerm, StringComparison.OrdinalIgnoreCase)) &&
            // Status filter
            (string.IsNullOrEmpty(_selectedStatus) || m.Status == _selectedStatus) &&
            // Severity filter
            (string.IsNullOrEmpty(_selectedSeverity) || m.Severity == _selectedSeverity)
        ).OrderByDescending(m => m.ReportedAt);

    /// <summary>
    /// Component initialization.
    /// </summary>
    protected override async Task OnInitializedAsync()
    {
        try
        {
            _isAuthorized = await AuthService.IsSuperAdminAsync();
            
            if (_isAuthorized)
            {
                await RefreshDataAsync();
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add(TranslationService.GetTranslation("superAdmin.initializationError", "Errore durante l'inizializzazione: {0}", ex.Message), Severity.Error);
        }
        finally
        {
            _isLoading = false;
        }
    }

    /// <summary>
    /// Refresh data from mock source.
    /// </summary>
    private async Task RefreshDataAsync()
    {
        try
        {
            _isLoadingReports = true;
            
            // TODO: Replace with actual service call when backend is implemented
            // _reportedMessages = await ChatService.GetReportedMessagesAsync();
            
            await Task.Delay(500); // Simulate API call
            _reportedMessages = GenerateReportedMessagePlaceholders();
            
            Snackbar.Add(TranslationService.GetTranslation("common.dataRefreshed", "Dati aggiornati"), Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add(TranslationService.GetTranslation("superAdmin.errorLoadingMessages", "Errore nel caricamento dei messaggi: {0}", ex.Message), Severity.Error);
        }
        finally
        {
            _isLoadingReports = false;
        }
    }

    /// <summary>
    /// Clear all active filters.
    /// </summary>
    private void ClearFilters()
    {
        _searchTerm = string.Empty;
        _selectedStatus = string.Empty;
        _selectedSeverity = string.Empty;
        StateHasChanged();
    }

    /// <summary>
    /// Handle search term changes with debouncing.
    /// </summary>
    private async Task OnSearchChanged()
    {
        // Cancel previous debounce if any
        _searchDebounceCts?.Cancel();
        _searchDebounceCts = new CancellationTokenSource();
        var token = _searchDebounceCts.Token;
        
        try
        {
            await Task.Delay(300, token);
            if (!token.IsCancellationRequested)
            {
                StateHasChanged();
            }
        }
        catch (OperationCanceledException)
        {
            // Swallow cancellation
        }
    }

    /// <summary>
    /// View message details in dialog.
    /// TODO: Implement message details modal
    /// </summary>
    private async Task ViewMessageDetailsAsync(ReportedMessageDto message)
    {
        await Task.Delay(100); // Placeholder
        Snackbar.Add($"Visualizza dettagli messaggio ID: {message.MessageId} - Da implementare", Severity.Info);
    }

    /// <summary>
    /// Approve reported message.
    /// TODO: Implement actual service integration
    /// </summary>
    private async Task ApproveMessageAsync(int messageId)
    {
        try
        {
            // TODO: Replace with actual service call
            await Task.Delay(500); // Placeholder
            
            var message = _reportedMessages.FirstOrDefault(m => m.MessageId == messageId);
            if (message != null)
            {
                message.Status = "approved";
                StateHasChanged();
            }
            
            Snackbar.Add(TranslationService.GetTranslation("superAdmin.messageApproved", "Messaggio approvato"), Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Errore nell'approvazione: {ex.Message}", Severity.Error);
        }
    }

    /// <summary>
    /// Block reported message.
    /// TODO: Implement actual service integration
    /// </summary>
    private async Task BlockMessageAsync(int messageId)
    {
        try
        {
            // TODO: Replace with actual service call
            await Task.Delay(500); // Placeholder
            
            var message = _reportedMessages.FirstOrDefault(m => m.MessageId == messageId);
            if (message != null)
            {
                message.Status = "blocked";
                StateHasChanged();
            }
            
            Snackbar.Add(TranslationService.GetTranslation("superAdmin.messageBlocked", "Messaggio bloccato"), Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Errore nel blocco: {ex.Message}", Severity.Error);
        }
    }

    /// <summary>
    /// Moderate user (warning, temporary ban, permanent ban).
    /// TODO: Implement user moderation dialog
    /// </summary>
    private async Task ModerateUserAsync(int userId)
    {
        await Task.Delay(100); // Placeholder
        Snackbar.Add($"Moderazione utente ID: {userId} - Da implementare", Severity.Info);
    }

    /// <summary>
    /// Get color for severity level.
    /// </summary>
    private Color GetSeverityColor(string severity) => severity?.ToLower() switch
    {
        "low" => Color.Info,
        "medium" => Color.Warning,
        "high" => Color.Error,
        "critical" => Color.Error,
        _ => Color.Default
    };

    /// <summary>
    /// Get text for severity level.
    /// </summary>
    private string GetSeverityText(string severity) => severity?.ToLower() switch
    {
        "low" => TranslationService.GetTranslation("superAdmin.severityLow", "Bassa"),
        "medium" => TranslationService.GetTranslation("superAdmin.severityMedium", "Media"),
        "high" => TranslationService.GetTranslation("superAdmin.severityHigh", "Alta"),
        "critical" => TranslationService.GetTranslation("superAdmin.severityCritical", "Critica"),
        _ => severity
    };

    /// <summary>
    /// Get color for moderation status.
    /// </summary>
    private Color GetStatusColor(string status) => status?.ToLower() switch
    {
        "pending" => Color.Warning,
        "approved" => Color.Success,
        "blocked" => Color.Error,
        "reviewed" => Color.Info,
        _ => Color.Default
    };

    /// <summary>
    /// Get text for moderation status.
    /// </summary>
    private string GetStatusText(string status) => status?.ToLower() switch
    {
        "pending" => TranslationService.GetTranslation("superAdmin.pending", "In Attesa"),
        "approved" => TranslationService.GetTranslation("superAdmin.approved", "Approvato"),
        "blocked" => TranslationService.GetTranslation("superAdmin.blocked", "Bloccato"),
        "reviewed" => TranslationService.GetTranslation("superAdmin.reviewed", "Revisionato"),
        _ => status
    };

    /// <summary>
    /// Generate placeholder reported messages.
    /// TODO: Remove when actual service is implemented
    /// </summary>
    private List<ReportedMessageDto> GenerateReportedMessagePlaceholders()
    {
        return new List<ReportedMessageDto>
        {
            new() { MessageId = 1001, ChatName = "Team Alpha", SenderName = "Mario Rossi", SenderId = 123, MessageContent = "Messaggio inappropriato da moderare...", ReportReason = "inappropriate", Severity = "medium", Status = "pending", ReportedAt = DateTime.Now.AddHours(-2), IsGroupChat = true },
            new() { MessageId = 1002, ChatName = "John Doe", SenderName = "John Doe", SenderId = 124, MessageContent = "Spam message with promotional content...", ReportReason = "spam", Severity = "low", Status = "pending", ReportedAt = DateTime.Now.AddHours(-4), IsGroupChat = false },
            new() { MessageId = 1003, ChatName = "Support Team", SenderName = "Anna Verdi", SenderId = 125, MessageContent = "Contenuto molesto verso altri utenti...", ReportReason = "harassment", Severity = "high", Status = "reviewed", ReportedAt = DateTime.Now.AddHours(-6), IsGroupChat = true },
            new() { MessageId = 1004, ChatName = "Sales Team", SenderName = "Luca Bianchi", SenderId = 126, MessageContent = "Contenuto violento o minaccioso...", ReportReason = "violence", Severity = "critical", Status = "blocked", ReportedAt = DateTime.Now.AddDays(-1), IsGroupChat = true },
            new() { MessageId = 1005, ChatName = "Maria Green", SenderName = "Maria Green", SenderId = 127, MessageContent = "Link sospetti o phishing...", ReportReason = "spam", Severity = "medium", Status = "pending", ReportedAt = DateTime.Now.AddHours(-1), IsGroupChat = false }
        };
    }

    /// <summary>
    /// Placeholder DTO for reported messages.
    /// TODO: Move to appropriate DTO project location when backend is implemented
    /// </summary>
    public class ReportedMessageDto
    {
        public int MessageId { get; set; }
        public string ChatName { get; set; } = "";
        public string SenderName { get; set; } = "";
        public int SenderId { get; set; }
        public string MessageContent { get; set; } = "";
        public string ReportReason { get; set; } = "";
        public string Severity { get; set; } = "";
        public string Status { get; set; } = "";
        public DateTime ReportedAt { get; set; }
        public bool IsGroupChat { get; set; }
    }
}
