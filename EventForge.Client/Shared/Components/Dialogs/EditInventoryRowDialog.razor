@using EventForge.DTOs.Warehouse
@using EventForge.DTOs.Products
@inject ITranslationService TranslationService

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Outlined.Edit" Class="mr-2" />
            @TranslationService.GetTranslation("warehouse.editRow", "Modifica Riga Inventario")
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudStack Spacing="3">
            <!-- Product Information Display (Read-only) -->
            @if (!string.IsNullOrEmpty(ProductName))
            {
                <MudPaper Elevation="0" Class="pa-3" Style="background-color: var(--mud-palette-background-grey);">
                    <MudText Typo="Typo.caption" Color="Color.Secondary">
                        @TranslationService.GetTranslation("products.product", "Prodotto")
                    </MudText>
                    <MudText Typo="Typo.body1" Style="font-weight: 600;">
                        @ProductName
                    </MudText>
                </MudPaper>
            }

            <!-- Edit Form -->
            <MudForm @ref="_form" @bind-IsValid="@_isFormValid">
                <MudStack Spacing="3">
                    <MudNumericField T="decimal"
                                    @bind-Value="_quantity"
                                    Label="@TranslationService.GetTranslation("warehouse.quantity", "QuantitÃ ")"
                                    Variant="Variant.Outlined"
                                    Min="0"
                                    Required="true"
                                    RequiredError="@TranslationService.GetTranslation("validation.required", "Campo obbligatorio")"
                                    Adornment="Adornment.Start"
                                    AdornmentIcon="@Icons.Material.Outlined.Numbers" />

                    <MudTextField @bind-Value="_notes"
                                 Label="@TranslationService.GetTranslation("warehouse.notes", "Note")"
                                 Variant="Variant.Outlined"
                                 Lines="2"
                                 MaxLength="200"
                                 Counter="200"
                                 Adornment="Adornment.Start"
                                 AdornmentIcon="@Icons.Material.Outlined.Comment" />
                </MudStack>
            </MudForm>
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" 
                   Color="Color.Default" 
                   Variant="Variant.Text">
            @TranslationService.GetTranslation("common.cancel", "Annulla")
        </MudButton>
        <MudButton OnClick="Submit" 
                   Color="Color.Primary" 
                   Variant="Variant.Filled"
                   Disabled="@(!_isFormValid)">
            @TranslationService.GetTranslation("common.save", "Salva")
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter] public decimal Quantity { get; set; }
    [Parameter] public string? Notes { get; set; }
    [Parameter] public string ProductName { get; set; } = string.Empty;

    private MudForm? _form;
    private bool _isFormValid;
    private decimal _quantity;
    private string? _notes;

    protected override void OnInitialized()
    {
        _quantity = Quantity;
        _notes = Notes;
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }

    private void Submit()
    {
        if (_isFormValid)
        {
            var result = new EditInventoryRowResult
            {
                Quantity = _quantity,
                Notes = _notes
            };
            MudDialog.Close(DialogResult.Ok(result));
        }
    }

    public class EditInventoryRowResult
    {
        public decimal Quantity { get; set; }
        public string? Notes { get; set; }
    }
}
